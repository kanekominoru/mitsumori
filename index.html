<!DOCTYPE html>
<html>
  <head>
    <base target="_top">

  </head>
  <body>
    <form action="https://script.google.com/macros/s/AKfycbyLJibLUxEfNuwgN69IoFUGI5eEdr9Ne-QfyBihyUChf2nHV9drBFWswyTLl-obWDtCGA/exec" id="cc-form" method="post">
      <div class="fTop">
        <span>Name:* </span><input name="txtName" type="text" placeholder="Your Name" id="fname" required="" autofocus>
        <span>E-Mail:* </span><input name="txtEmail" type="email" placeholder="Your e-Mail" id="femail" required="">
      </div>
      <!--------------------------->
      <div class="fSet1">
        <span>Notes:</span><br/>
        <textarea name="txtArea" id="fTextArea" rows="8"></textarea>
      </div>
      <!--------------------------->
      <div id="data"></div> <!-- Added -->
      <div class="fSub">
      <span>Upload your File:* </span><input name="fFileAttach" id="fFileAttach" type="file" required>
      <input id="submit" type="submit">
      </div>
    </form>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.js"></script> <!-- Added -->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" crossorigin="anonymous"></script>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>

    <!-- Added -->
    <script>
      const myForm = document.querySelector("#cc-form");
      const liffId = "2007083053-YNDKlL8v";
      let userId = "";
      liff.init({liffId: liffId})
              .catch((err) => {
                  console.log(err);
              });
      liff.ready.then(() => {
          if (!liff.isLoggedIn()) {
              liff.login();
          }
          const idToken = liff.getDecodedIDToken();
          userId = idToken.sub;
          $('form').append(`<input type="hidden" name="userId" value="${userId}">`);
      });
      myForm.addEventListener("submit", (event)=>{
        sendText('text');
      });
      $('#fFileAttach').on("change", function() {
          var file = this.files[0];
          var fr = new FileReader();
          fr.fileName = file.name;
          fr.onload = function(e) {
              html = '<input type="hidden" name="data" value="'+e.target.result.replace(/^.*,/, '')+'" >';
              html += '<input type="hidden" name="filename" value="'+e.target.fileName+'" >';
              html += '<input type="hidden" name="mimetype" value="' + e.target.result.match(/^.*(?=;)/)[0] + '" >';
              $("#data").empty().append(html); // Modified
          }
          fr.readAsDataURL(file);
      });
      const sendText = (text) => {
                  liff.sendMessages([{
                      'type': 'text',
                      'text': text,
                  }]).then(function () {
                      liff.closeWindow();
                  }).catch(function (error) {
                      window.alert('Failed to send message ' + error);
                  });
              }
    </script>
  </body>
</html>

